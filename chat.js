// AI Chat Bot for Marketing in Deutschland - Enhanced Multilingual Version
class ChatBot {
  constructor() {
    this.isOpen = false;
    this.currentLanguage = 'ua';
    this.responses = {
      de: {
        greeting: "Hallo! üëã Ich bin Ihr digitaler Marketing-Assistent. Wie kann ich Ihnen helfen?",
        services: "Wir bieten Website-Entwicklung, Google Ads, SEO und Social Media Marketing. Welcher Service interessiert Sie am meisten?",
        pricing: "Unsere Preise sind projektabh√§ngig und sehr wettbewerbsf√§hig. Kontaktieren Sie uns f√ºr ein kostenloses Angebot √ºber Telegram: @Marketing_in_Deutschland",
        contact: "Sie k√∂nnen uns jederzeit erreichen:\nüì± Telegram: https://t.me/Marketing_in_Deutschland\nüìß E-Mail: info@marketing-in-deutschland.de\n‚è∞ Wir antworten innerhalb von 2 Stunden!",
        experience: "Wir haben √ºber 8 Jahre Erfahrung im digitalen Marketing und haben bereits 150+ erfolgreiche Projekte abgeschlossen. Unsere Kundenzufriedenheit liegt bei 95%!",
        website: "Wir entwickeln moderne, responsive Websites mit optimaler Performance. Durchschnittliche Ladezeit unter 2 Sekunden garantiert!",
        seo: "Unser SEO-Service erh√∂ht Ihre organische Sichtbarkeit. Durchschnittlich 250% Traffic-Steigerung in 6 Monaten!",
        ads: "Google Ads Management mit messbaren Ergebnissen. ROI-Verbesserung um durchschnittlich 300%!",
        social: "Social Media Marketing f√ºr mehr Engagement und Kundenbindung. Follower-Wachstum um 400% m√∂glich!",
        default: "Das ist eine interessante Frage! F√ºr eine detaillierte Beratung kontaktieren Sie uns gerne direkt √ºber Telegram: @Marketing_in_Deutschland"
      },
      en: {
        greeting: "Hello! üëã I'm your digital marketing assistant. How can I help you today?",
        services: "We offer website development, Google Ads, SEO, and social media marketing. Which service interests you most?",
        pricing: "Our prices are project-dependent and very competitive. Contact us for a free quote via Telegram: @Marketing_in_Deutschland",
        contact: "You can reach us anytime:\nüì± Telegram: https://t.me/Marketing_in_Deutschland\nüìß Email: info@marketing-in-deutschland.de\n‚è∞ We respond within 2 hours!",
        experience: "We have over 8 years of experience in digital marketing and have completed 150+ successful projects. Our customer satisfaction rate is 95%!",
        website: "We develop modern, responsive websites with optimal performance. Average loading time under 2 seconds guaranteed!",
        seo: "Our SEO service increases your organic visibility. Average 250% traffic increase in 6 months!",
        ads: "Google Ads management with measurable results. ROI improvement by an average of 300%!",
        social: "Social media marketing for more engagement and customer loyalty. Follower growth of 400% possible!",
        default: "That's an interesting question! For detailed consultation, please contact us directly via Telegram: @Marketing_in_Deutschland"
      },
      ua: {
        greeting: "–ü—Ä–∏–≤—ñ—Ç! üëã –Ø –≤–∞—à –∞—Å–∏—Å—Ç–µ–Ω—Ç –∑ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É. –Ø–∫ —è –º–æ–∂—É –≤–∞–º –¥–æ–ø–æ–º–æ–≥—Ç–∏?",
        services: "–ú–∏ –ø—Ä–æ–ø–æ–Ω—É—î–º–æ —Ä–æ–∑—Ä–æ–±–∫—É –≤–µ–±-—Å–∞–π—Ç—ñ–≤, Google Ads, SEO —Ç–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂–∞—Ö. –Ø–∫–∞ –ø–æ—Å–ª—É–≥–∞ –≤–∞—Å –Ω–∞–π–±—ñ–ª—å—à–µ —Ü—ñ–∫–∞–≤–∏—Ç—å?",
        pricing: "–ù–∞—à—ñ —Ü—ñ–Ω–∏ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –ø—Ä–æ–µ–∫—Ç—É —Ç–∞ –¥—É–∂–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø—Ä–æ–º–æ–∂–Ω—ñ. –ó–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏ –¥–ª—è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ—ó –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó —á–µ—Ä–µ–∑ Telegram: @Marketing_in_Deutschland",
        contact: "–í–∏ –º–æ–∂–µ—Ç–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∞–º–∏ –±—É–¥—å-–∫–æ–ª–∏:\nüì± Telegram: https://t.me/Marketing_in_Deutschland\nüìß Email: info@marketing-in-deutschland.de\n‚è∞ –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î–º–æ –ø—Ä–æ—Ç—è–≥–æ–º 2 –≥–æ–¥–∏–Ω!",
        experience: "–£ –Ω–∞—Å –ø–æ–Ω–∞–¥ 8 —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–º—É –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É, —ñ –º–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ 150+ —É—Å–ø—ñ—à–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤. –ù–∞—à–∞ –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å –∫–ª—ñ—î–Ω—Ç—ñ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å 95%!",
        website: "–ú–∏ —Ä–æ–∑—Ä–æ–±–ª—è—î–º–æ —Å—É—á–∞—Å–Ω—ñ, –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ –≤–µ–±-—Å–∞–π—Ç–∏ –∑ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é. –ì–∞—Ä–∞–Ω—Ç—É—î–º–æ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—à–µ 2 —Å–µ–∫—É–Ω–¥!",
        seo: "–ù–∞—à SEO-—Å–µ—Ä–≤—ñ—Å –ø—ñ–¥–≤–∏—â—É—î –≤–∞—à—É –æ—Ä–≥–∞–Ω—ñ—á–Ω—É –≤–∏–¥–∏–º—ñ—Å—Ç—å. –í —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ç—Ä–∞—Ñ—ñ–∫—É –Ω–∞ 250% –∑–∞ 6 –º—ñ—Å—è—Ü—ñ–≤!",
        ads: "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Google Ads –∑ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è ROI –≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –Ω–∞ 300%!",
        social: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂–∞—Ö –¥–ª—è –±—ñ–ª—å—à–æ–≥–æ –∑–∞–ª—É—á–µ–Ω–Ω—è —Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ –∫–ª—ñ—î–Ω—Ç—ñ–≤. –ú–æ–∂–ª–∏–≤–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –Ω–∞ 400%!",
        default: "–¶–µ —Ü—ñ–∫–∞–≤–µ –ø–∏—Ç–∞–Ω–Ω—è! –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —á–µ—Ä–µ–∑ Telegram: @Marketing_in_Deutschland"
      },
      ru: {
        greeting: "–ü—Ä–∏–≤–µ—Ç! üëã –Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–º—É –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É. –ö–∞–∫ —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?",
        services: "–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤–µ–±-—Å–∞–π—Ç–æ–≤, Google Ads, SEO –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö. –ö–∞–∫–∞—è —É—Å–ª—É–≥–∞ –≤–∞—Å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
        pricing: "–ù–∞—à–∏ —Ü–µ–Ω—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ—á–µ–Ω—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram: @Marketing_in_Deutschland",
        contact: "–í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è:\nüì± Telegram: https://t.me/Marketing_in_Deutschland\nüìß Email: info@marketing-in-deutschland.de\n‚è∞ –û—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤!",
        experience: "–£ –Ω–∞—Å –±–æ–ª–µ–µ 8 –ª–µ—Ç –æ–ø—ã—Ç–∞ –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–º –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ, –∏ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ 150+ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –ù–∞—à–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 95%!",
        website: "–ú—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≤–µ–±-—Å–∞–π—Ç—ã —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω–µ–µ 2 —Å–µ–∫—É–Ω–¥!",
        seo: "–ù–∞—à SEO-—Å–µ—Ä–≤–∏—Å –ø–æ–≤—ã—à–∞–µ—Ç –≤–∞—à—É –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å. –í —Å—Ä–µ–¥–Ω–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ 250% –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤!",
        ads: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Google Ads —Å –∏–∑–º–µ—Ä–∏–º—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏. –£–ª—É—á—à–µ–Ω–∏–µ ROI –≤ —Å—Ä–µ–¥–Ω–µ–º –Ω–∞ 300%!",
        social: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—è –∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤. –í–æ–∑–º–æ–∂–µ–Ω —Ä–æ—Å—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ 400%!",
        default: "–≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Telegram: @Marketing_in_Deutschland"
      },
      pl: {
        greeting: "Cze≈õƒá! üëã Jestem twoim asystentem marketingu cyfrowego. Jak mogƒô ci pom√≥c?",
        services: "Oferujemy tworzenie stron internetowych, Google Ads, SEO i marketing w mediach spo≈Çeczno≈õciowych. Kt√≥ra us≈Çuga ciƒô najbardziej interesuje?",
        pricing: "Nasze ceny zale≈ºƒÖ od projektu i sƒÖ bardzo konkurencyjne. Skontaktuj siƒô z nami po bezp≈ÇatnƒÖ wycenƒô przez Telegram: @Marketing_in_Deutschland",
        contact: "Mo≈ºesz skontaktowaƒá siƒô z nami w dowolnym momencie:\nüì± Telegram: https://t.me/Marketing_in_Deutschland\nüìß Email: info@marketing-in-deutschland.de\n‚è∞ Odpowiadamy w ciƒÖgu 2 godzin!",
        experience: "Mamy ponad 8 lat do≈õwiadczenia w marketingu cyfrowym i uko≈Ñczyli≈õmy 150+ udanych projekt√≥w. Nasze zadowolenie klient√≥w wynosi 95%!",
        website: "Tworzymy nowoczesne, responsywne strony internetowe o optymalnej wydajno≈õci. Gwarantujemy czas ≈Çadowania poni≈ºej 2 sekund!",
        seo: "Nasza us≈Çuga SEO zwiƒôksza twojƒÖ organicznƒÖ widoczno≈õƒá. ≈örednio 250% wzrost ruchu w ciƒÖgu 6 miesiƒôcy!",
        ads: "ZarzƒÖdzanie Google Ads z mierzalnymi rezultatami. Poprawa ROI ≈õrednio o 300%!",
        social: "Marketing w mediach spo≈Çeczno≈õciowych dla wiƒôkszego zaanga≈ºowania i lojalno≈õci klient√≥w. Mo≈ºliwy wzrost obserwujƒÖcych o 400%!",
        default: "To ciekawe pytanie! W celu szczeg√≥≈Çowej konsultacji skontaktuj siƒô z nami bezpo≈õrednio przez Telegram: @Marketing_in_Deutschland"
      }
    };
    
    this.keywords = {
      services: ['service', '—É—Å–ª—É–≥–∞', '–ø–æ—Å–ª—É–≥–∞', 'us≈Çuga', 'leistung', 'website', 'seo', 'ads', 'social', '–ø–æ—Å–ª—É–≥–∏', '—É—Å–ª—É–≥–∏', 'us≈Çugi'],
      pricing: ['price', 'cost', '—Ü–µ–Ω–∞', '—Ü—ñ–Ω–∞', 'cena', 'preis', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '–≤–∞—Ä—Ç—ñ—Å—Ç—å', 'koszt', '—Å–∫–æ–ª—å–∫–æ', '—Å–∫—ñ–ª—å–∫–∏'],
      contact: ['contact', '–∫–æ–Ω—Ç–∞–∫—Ç', 'telefon', 'email', 'telegram', '—Å–≤—è–∑–∞—Ç—å—Å—è', '–∑–≤\'—è–∑–∞—Ç–∏—Å—è', 'skontaktowaƒá'],
      experience: ['experience', '–æ–ø—ã—Ç', '–¥–æ—Å–≤—ñ–¥', 'do≈õwiadczenie', 'erfahrung', '—Ä–æ–∫—ñ–≤', '–ª–µ—Ç', 'lat'],
      website: ['website', '—Å–∞–π—Ç', '–≤–µ–±-—Å–∞–π—Ç', 'strona', 'webseite', 'site', 'web'],
      seo: ['seo', '–ø–æ–∏—Å–∫–æ–≤–∞—è', '–ø–æ—à—É–∫–æ–≤–∞', '–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è', 'optymalizacja', 'search'],
      ads: ['ads', '—Ä–µ–∫–ª–∞–º–∞', 'advertising', 'google', '–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è', '–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞', 'reklama'],
      social: ['social', '—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ', '—Å–æ—Ü—ñ–∞–ª—å–Ω—ñ', 'spo≈Çeczne', 'facebook', 'instagram', 'smm']
    };
    
    this.init();
  }

  init() {
    this.bindEvents();
    this.updateLanguage();
  }

  bindEvents() {
    // Language change detection
    document.addEventListener('languageChanged', (e) => {
      this.currentLanguage = e.detail.language;
      // Clear chat and send new greeting
      const chatBody = document.getElementById('chatBody');
      if (chatBody) {
        chatBody.innerHTML = '';
        setTimeout(() => {
          this.sendBotMessage(this.responses[this.currentLanguage].greeting);
        }, 300);
      }
    });
  }

  updateLanguage() {
    const langSelect = document.querySelector('#lang');
    if (langSelect) {
      this.currentLanguage = langSelect.value;
    }
  }

  analyzeMessage(message) {
    const lowerMessage = message.toLowerCase();
    
    for (const [category, keywords] of Object.entries(this.keywords)) {
      if (keywords.some(keyword => lowerMessage.includes(keyword))) {
        return category;
      }
    }
    
    return 'default';
  }

  generateResponse(message) {
    const category = this.analyzeMessage(message);
    const responses = this.responses[this.currentLanguage];
    
    return responses[category] || responses.default;
  }

  sendMessage(userMessage) {
    if (!userMessage.trim()) return;

    const chatBody = document.getElementById('chatBody');
    
    // Add user message
    this.addMessage(chatBody, 'user', userMessage);
    
    // Generate bot response with realistic delay
    setTimeout(() => {
      const botResponse = this.generateResponse(userMessage);
      this.addMessage(chatBody, 'bot', botResponse);
      chatBody.scrollTop = chatBody.scrollHeight;
    }, Math.random() * 1500 + 800); // Random delay between 0.8-2.3 seconds
    
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  addMessage(container, type, message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `msg ${type}`;
    
    // Handle line breaks in bot messages
    const formattedMessage = message.replace(/\n/g, '<br>');
    messageDiv.innerHTML = `<div class="bubble">${formattedMessage}</div>`;
    
    container.appendChild(messageDiv);
    
    // Add animation
    messageDiv.style.opacity = '0';
    messageDiv.style.transform = 'translateY(20px)';
    setTimeout(() => {
      messageDiv.style.transition = 'all 0.3s ease';
      messageDiv.style.opacity = '1';
      messageDiv.style.transform = 'translateY(0)';
    }, 50);
  }

  sendBotMessage(message) {
    const chatBody = document.getElementById('chatBody');
    this.addMessage(chatBody, 'bot', message);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  toggle() {
    const panel = document.getElementById('chatPanel');
    const backdrop = document.getElementById('chatBackdrop');
    
    this.isOpen = !this.isOpen;
    
    if (this.isOpen) {
      panel.classList.add('open');
      backdrop.classList.add('open');
      
      // Send greeting if it's the first time opening or chat is empty
      const chatBody = document.getElementById('chatBody');
      if (!chatBody || chatBody.children.length === 0) {
        setTimeout(() => {
          this.sendBotMessage(this.responses[this.currentLanguage].greeting);
        }, 300);
      }
    } else {
      panel.classList.remove('open');
      backdrop.classList.remove('open');
    }
  }
}

// Initialize chat bot
const chatBot = new ChatBot();

// Global functions for HTML onclick handlers
function toggleChat() {
  chatBot.toggle();
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (message) {
    chatBot.sendMessage(message);
    input.value = '';
  }
}

function handleEnter(event) {
  if (event.key === 'Enter') {
    sendMessage();
  }
}

// Export for use in main script
if (typeof window !== 'undefined') {
  window.chatBot = chatBot;
}